<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <button id="oBn1"></button>
    <button id="oBn2"></button>
    <script>
        //es5
        // var obj = {
        //     name: '123',
        //     age: 34,
        //     info: {
        //         hobby: ['a', 'b', {
        //             c: 1,
        //             d: 1
        //         }],
        //         career: {
        //             teacher: 4,
        //             engineer: 9
        //         }
        //     }
        // }
        // function deepClone(origin,target){
        //     var tar = target || {};
        //     var toStr = Object.prototype.toString;
        //     var arrType = '[object Array]';
        //     for(var k in origin){
        //         if(origin.hasOwnProperty(k)){
        //             if(typeof origin[k] === 'object' && origin[k] !== null){
        //                 tar[k] = toStr.call(origin[k]) === arrType ? [] : {};
        //                 deepClone(origin[k],tar[k]);
        //             }else{
        //                 tar[k] = origin[k];
        //             }
        //         }
        //     }
        //     return tar;
        // }
        // const newObj = deepClone(obj,{});
        // newObj.info.hobby[2].c = 123;
        // console.log(obj,newObj);

        //es6
        // WeakMap Map都是存储键值对 
        // Map     键名 -> 任意类型  
        // WeakMap 键名 -> 对象
        // {}      键名 -> 字符串,symbol

        // const oBn1 = document.querySelector("#oBn1");
        // const oBn2 = document.querySelector("#oBn2");

        // oBn1.addEventListener('click',handleBtn1Click,false);
        // oBn2.addEventListener('click',handleBtn2Click,false);

        // function handleBtn1Click(){}
        // function handleBtn2Click(){}

        // oBn1.remove();
        // oBn2.remove();

        // //垃圾回收机制
        // handleBtn1Click = null;
        // handleBtn2Click = null;

        // const oBtnMap = new WeakMap();
        // oBtnMap.set(oBn1,handleBtn1Click);
        // oBtnMap.set(oBn2,handleBtn1Click);

        // oBn1.addEventListener('click',oBtnMap.get(oBn1),false);
        // oBn2.addEventListener('click',oBtnMap.get(oBn2),false);

        // function handleBtn1Click(){}
        // function handleBtn2Click(){}

        // oBn1.remove();
        // oBn2.remove();
        // //弱引用，自动垃圾回收


        //es6 null undefined Date RegExp instanceof
        // function deepClone(origin) {
        //     if (origin == undefined || typeof origin !== 'object') {
        //         return origin;
        //     }
        //     if (origin instanceof Date) {
        //         return new Date(origin);
        //     }
        //     if (origin instanceof RegExp) {
        //         return new RegExp(origin);
        //     }
        //     const target = new origin.constructor();
        //     for (let k in origin) {
        //         if (origin.hasOwnProperty(k)) {
        //             target[k] = deepClone(origin[k]);
        //         }
        //     }
        //     return target;
        // }
        
        // const newObj = deepClone(obj);
        // newObj.info.hobby[2].a = 123456;
        // console.log(obj);
        // console.log(newObj);

        // const obj = {};
        // const newObj = new obj.constructor();
        // console.log(obj);
        // newObj.a = 1;
        // console.log(newObj);

        // const arr = [];
        // const newArr = new arr.constructor();
        // newArr.push(1);
        // console.log(arr,newArr);

        // let test1 = {};
        // let test2 = {};
        // test2.test1 = test1;
        // //把test1作为属性给test2
        // test1.test2 = test2;
        // //导致无限循环
        // function deepClone(origin,hashMap = new WeakMap()) {
        //     if (origin == undefined || typeof origin !== 'object') {
        //         return origin;
        //     }
        //     if (origin instanceof Date) {
        //         return new Date(origin);
        //     }
        //     if (origin instanceof RegExp) {
        //         return new RegExp(origin);
        //     }

        //     const hashKey = hashMap.get(origin);
        //     if(hashKey){
        //         return hashKey;
        //     }

        //     const target = new origin.constructor();
        //     hashMap.set(origin,target)
        //     for (let k in origin) {
        //         if (origin.hasOwnProperty(k)) {
        //             target[k] = deepClone(origin[k],hashMap);
        //         }
        //     }
        //     return target;
        // }

        // console.log(deepClone(test2))
    </script>
</body>

</html>