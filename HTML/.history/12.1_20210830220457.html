<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <title>Document</title>
</head>
<body>
    <div class="container">
        <table class="table table-striped table-hover" align="center" id="box">
        </table>
    </div>
    <script src="./JSONP封装完成函数.js"></script>
    <script src="./template-web.js"></script>
    <!-- 模板 -->
    <script type="text/html" id="tpl">
        <tr>
            <th>时间</th>
            <th>温度</th>
            <th>天气</th>
            <th>风向</th>
            <th>风力</th>
        </tr>
        {{each data}}           
            <tr>
                <td>{{dataFormat($value.update_time)}}</td>
                <td>{{$value.degree}}</td>
                <td>{{$value.weather}}</td>
                <td>{{$value.wind_direction}}</td>
                <td>{{$value.wind_power}}</td>
            </tr>          
        {{/each}}
    </script>
    <script>
        // 获取box标签 用来显示模板数据的地方s
        var box = document.getElementById('box');
        // node的语法规则 将dataFormat暴露出来使模板中的数据可以调用此方法
        // 第一个dataFormat表示追加的属性，模板中可以使用的属性
        // 第二个dataFormat表示函数名，调用此函数方法
        template.defaults.imports.dataFormat = dataFormat;
        // 将返回的时间数据进行格式化
        function dataFormat(data){
            var year = data.substr(0,4);
            var month = data.substr(4,2);
            var day = data.substr(6,2);
            var hour = data.substr(8,2);
            var min = data.substr(10,2);
            var sec = data.substr(12,2);
            return year + '年' + month + '月' + day + '日' + ' ' + hour + ':' + min + ':' + sec;
        }
        //调用jsonp方法
        jsonp({
            url:'https://wis.qq.com/weather/common',
            data:{
                source:'pc',
                weather_type:'forecast_1h',
                province: '浙江省',
                city: '丽水市'
            },
            success:function(data){
                // 将模板与数据进行拼接
                var html = template('tpl',{data:data.data.forecast_1h});
                // 将拼接好的html显示在页面上
                box.innerHTML = html;               
            }
        });
    </script>
</body>
</html>
